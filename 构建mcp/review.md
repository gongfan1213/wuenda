### MCP（Model Context Protocol）相关课程及协议概述总结

#### 1. 课程基本信息
- **课程名称**：MCP: Build Rich-Context AI Apps with Anthropic
- **合作方**：Anthropic 与其他方合作推出
- **讲师**：Elie Schoppik（Anthropic 技术教育主管）
- **课程目标**：教授 MCP 的核心概念及在 AI 应用中的实现方法

#### 2. MCP 协议核心定义与架构
- **定义**：MCP 是一种开放协议，基于客户端-服务器架构，标准化 LLM 应用获取工具和数据资源等上下文的方式。
- **通信机制**：定义了 LLM 应用内部的 MCP 客户端与暴露工具、数据资源和提示模板的 MCP 服务器之间的通信方式。
- **起源**：源于 Anthropic 内部项目，旨在扩展 Claude Desktop 的能力，使其能与本地文件系统和其他外部系统交互；后因该协议在众多有类似需求的 AI 应用中有用，故发布规范并向开源社区开放开发。

#### 3. MCP 生态与特点
- **生态**：包含越来越多由开源社区和 Anthropic 的 MCP 团队开发的 MCP 服务。
- **特点**：模型无关，易于接入多个应用。例如，构建研究助手代理时，无需编写自定义 LLM 工具，只需连接到 GitHub、Google Drive 和文件系统服务，这些服务会提供工具或 API 调用定义并处理工具执行。

#### 4. 课程主要内容
- 深入探讨 MCP 客户端-服务器架构。
- 开发聊天机器人应用使其兼容 MCP。
- 构建和测试 MCP 服务器，并将聊天机器人与之连接（服务器将为聊天机器人提供工具、提示模板和资源）。
- 将聊天机器人连接到其他可信第三方服务器以扩展其功能。
- 复用 MCP 服务器并将其连接到 Claude Desktop 等其他 MCP 应用。
- 学习如何远程部署 MCP 服务器。

#### 5. 其他信息
- MCP 于 2024 年 11 月由 Anthropic 推出，生态增长迅速。
- 感谢 DeepLearning.AI 的 Hawraa Salami 对本课程的贡献。
- MCP 的重要性：使 LLM 应用开发者能更轻松地将系统连接到众多工具和数据资源，也让工具构建团队或数据提供团队能更轻松地将其成果提供给众多开发者。
- 下一个视频将介绍为何在 MCP 出现前，将 LLM 应用连接到资源如此困难，以及 MCP 如何解决这一问题。

### 第一课时：MCP 的价值与核心优势总结

#### 1. MCP 的核心定位与目标
- **定义**：MCP（Model Context Protocol）是一种开源协议，标准化大型语言模型（LLM）与工具、数据源的连接和交互方式。
- **核心目标**：避免重复开发，实现“一次构建，随处使用”——让 AI 应用与外部系统的交互无需针对不同模型或数据源反复开发集成逻辑，而是采用统一标准。
- **类比参考**：类似 REST 协议标准化 Web 应用与后端的通信，MCP 旨在标准化 AI 应用与外部系统的交互；其理念借鉴了 2016 年微软开发的 LSP（Language Server Protocol，标准化 IDE 与特定语言工具的交互）等协议。

#### 2. MCP 的重要性：解决 AI 开发的痛点
- **模型与上下文的关系**：模型的能力取决于其获取的上下文，若无法连接外部世界获取数据，其价值会受限。
- **碎片化问题**：在 MCP 出现前，不同 AI 应用与同类数据源的交互逻辑重复开发，导致效率低下；MCP 通过标准化连接方式，解决了这一碎片化问题。

#### 3. MCP 的核心优势与特点
- **模型无关性**：可适配多种模型，不依赖特定模型提供商。
- **开源属性**：工具和数据连接能力由开源社区提供，开发者也可自行构建。
- **职责分离与复用性**：
  - 分离 AI 应用与数据访问逻辑，关注点更清晰。
  - MCP 服务器可跨多个应用复用（如为 Google Drive 构建的 MCP 服务器，可用于 AI 助手、代理或桌面应用等）。
- **简化集成**：开发者无需编写大量数据访问和认证逻辑，通过自然语言即可与外部数据源交互。

#### 4. MCP 应用场景示例（演示）
- 通过 Claude Desktop 连接 GitHub 和 Asana 的 MCP 服务器，仅用自然语言即可：
  - 从 GitHub 读取问题（issues）。
  - 在 Asana 中分类问题、创建任务并分配人员，实现跨数据源的读写操作。
  - 过程中支持“人类在环”（human in the loop）验证操作，确保安全性。

#### 5. MCP 生态与角色
- **服务器类型**：可针对不同数据源或工具构建（如数据存储、CRM 工具 HubSpot/Salesforce、版本控制等）。
- **多方受益**：
  - 应用开发者：轻松连接 MCP 服务器，减少开发工作量。
  - API 开发者：一次构建 MCP 服务器，即可被多方复用。
  - 用户：通过简单的 MCP 服务器 URL 即可获取所需数据访问能力。
  - 企业/组织：可构建独立集成供不同团队使用，提升效率。

#### 6. 后续内容预告
- 深入探讨 MCP 的底层工作原理。
- 介绍主机（hosts）、客户端（clients）、服务器（servers）等概念。
- 讲解协议中的核心元素：资源（resources）、工具（tools）、提示（prompts）。

### 第二课时：MCP 的架构、核心元素与通信机制总结

#### 1. MCP 的基础架构
- **架构模式**：基于客户端-服务器（Client-Server）架构，客户端与服务器保持一对一连接，通过 MCP 定义的消息进行通信。
- **核心角色**：
  - **客户端（Client）**：存在于主机（Host）内部，负责发现服务器提供的资源和工具。
  - **服务器（Server）**：轻量程序，通过协议暴露特定功能（工具、资源、提示模板等）。
  - **主机（Host）**：指 LLM 应用（如 Claude Desktop、Claude AI 等），负责存储和维护所有客户端及与 MCP 服务器的连接，是客户端的运行载体。


#### 2. MCP 的核心元素（Primitives）
MCP 协议通过以下三个核心元素实现功能扩展，均由服务器暴露，供客户端使用：

- **工具（Tools）**
  - 定义：可被客户端调用的函数，支持数据的检索、搜索、发送消息、更新数据库记录等操作（类似 HTTP 中的 POST 请求，涉及数据修改）。
  - 示例：SQLite 服务器提供的 `List Tables` 工具可查询数据库表结构，`Analyze` 工具可分析表中数据。

- **资源（Resources）**
  - 定义：服务器暴露的只读数据或上下文（类似 HTTP 中的 GET 请求，不涉及修改），客户端可选择是否使用这些数据。
  - 示例：数据库记录、API 响应、文件（PDF 等）、动态更新的业务洞察备忘录（随数据变化自动更新）。

- **提示模板（Prompt Templates）**
  - 定义：服务器预定义的模板，减轻用户的提示工程负担，用户只需传入动态数据即可使用。
  - 示例：SQLite 服务器提供的 `MCP demo prompt`，用户可通过输入“行星数据”自动生成初始化数据库的提示文本。


#### 3. 客户端与服务器的通信机制
- **通信流程**：
  1. **初始化**：客户端连接服务器时，发送初始化请求，服务器返回响应，最后通过通知确认初始化完成。
  2. **消息交换**：初始化后，客户端与服务器可双向发送请求和通知（如客户端请求工具调用，服务器返回执行结果）。
  3. **连接终止**：通信结束后，终止连接。

- **传输方式（Transports）**：
  负责处理客户端与服务器之间消息传递的底层机制，根据应用场景选择：
  - **标准输入输出（Standard IO）**：适用于本地运行的服务器，客户端通过子进程启动服务器，利用标准输入/输出进行通信。
  - **HTTP + 服务器发送事件（Server-Sent Events）**：适用于远程部署的服务器，需维持有状态连接，支持服务器向客户端主动发送事件。
  - **可流式 HTTP（Streamable HTTP）**：协议更新后推荐的传输方式，同时支持有状态（基于服务器发送事件）和无状态（纯 HTTP 请求）连接，更灵活地适配不同部署需求（如规模化无状态应用）。


#### 4. 实际应用演示（以 Claude Desktop 为例）
- **工具使用**：连接 SQLite 服务器后，通过自然语言调用 `List Tables` 工具查询表结构，调用 `Analyze` 工具分析产品表数据，并生成可视化结果（如价格分布图表）。
- **提示模板使用**：利用服务器提供的 `MCP demo prompt`，输入“行星数据”即可自动生成数据库初始化脚本，无需手动编写提示。
- **资源使用**：访问动态更新的业务洞察备忘录，基于数据库新数据自动更新内容。


#### 5. 后续内容预告
- 介绍实际开发中使用的工具和功能。
- 逐步实现 MCP 逻辑，构建自定义服务器、客户端和主机。
### 第三课时：基于工具使用的聊天机器人开发总结

#### 1. 课程目标
本课时聚焦于在引入 MCP 逻辑前，构建一个具备工具调用能力的基础聊天机器人，复习大语言模型（LLM）的工具使用和提示工程基础，为后续 MCP 服务器开发做铺垫。


#### 2. 核心功能与工具
聊天机器人主要通过调用以下工具实现对学术论文的检索与信息提取，依赖 `arxiv`  SDK（用于访问开源学术论文库 arXiv）和 Anthropic SDK（用于调用 Claude 模型）：

- **`search_papers` 函数**
  - 功能：根据用户输入的主题搜索 arXiv 上的论文，默认返回5篇结果。
  - 流程：初始化 arXiv 客户端 → 搜索相关论文 → 创建本地 `papers` 目录 → 将论文信息（ID、标题、URL、摘要等）保存至 `papers_info.json` 文件 → 返回论文 ID 列表。

- **`extract_info` 函数**
  - 功能：根据论文 ID 从 `papers_info.json` 中提取该论文的详细信息（标题、URL、摘要等）。
  - 异常处理：若未找到对应 ID 的论文，返回“无保存信息”提示。


#### 3. 工具定义与模型集成
- **工具列表（Tools List）**：为 LLM 定义可调用的工具 schema，包含工具名称、描述和参数（如 `search_papers` 需要 `topic` 参数，`extract_info` 需要 `paper_id` 参数）。
- **工具映射与执行**：通过字典将工具名称映射到对应的函数，实现 LLM 工具调用请求与实际函数执行的关联，确保模型输出的工具调用指令能被正确执行。
- **聊天循环逻辑**：
  1. 初始化 Anthropic 客户端，读取 API 密钥。
  2. 接收用户输入的查询，构建对话消息列表。
  3. 调用 Claude 3.7 Sonnet 模型，若模型决定使用工具，则执行对应函数并将结果返回给模型。
  4. 模型基于工具返回结果生成自然语言响应，完成一轮对话。
  5. 支持用户输入“quit”终止对话。


#### 4. 实际演示效果
- 基础交互：用户发送“hi”时，模型会说明自身功能及可用工具。
- 论文检索：用户输入“搜索代数相关的最新论文”，模型调用 `search_papers` 工具，返回论文 ID 并询问是否需要提取详情。
- 信息提取：用户要求提取前两篇论文的信息，模型调用 `extract_info` 工具，返回论文标题、摘要等内容并进行总结。
- 局限性：对话无持久化记忆，每次对话需重新处理，论文信息仅临时保存于本地文件。


#### 5. 后续内容预告
下一课将重构当前代码，将现有工具转换为 MCP 工具，实现通过 MCP 服务器暴露工具功能，并测试服务器与客户端的交互。

# 4

### 第四课时：基于标准IO传输的MCP服务器构建与测试总结

#### 1. 课程目标
本课时将上一课时实现的聊天机器人工具（论文检索与信息提取）封装为MCP服务器，使用`fast MCP`库简化开发，并通过MCP Inspector测试服务器功能，采用标准IO传输方式（适用于本地服务器）。


#### 2. MCP服务器构建步骤
- **核心库引入**：使用`fast MCP`库（`from mcp.server.fastmcp import FastMCP`），该库提供高层接口，简化MCP服务器开发。
- **服务器初始化**：创建`FastMCP`实例，指定服务器名称（如“research”）。
- **工具定义**：通过`@mcp.tool`装饰器，将原有工具函数（`search_papers`和`extract_info`）标记为MCP工具，自动生成工具schema。
- **启动配置**：通过`if __name__ == "__main__":`逻辑，调用`mcp.run(transport="stdio")`启动服务器，指定传输方式为标准IO（适用于本地运行）。


#### 3. 环境配置与依赖安装
- **项目初始化**：
  - 使用`uv`（快速Python包管理器）初始化项目：`uv init`。
  - 创建并激活虚拟环境：`uv venv` → `source .venv/bin/activate`（隔离项目依赖，避免冲突）。
- **依赖安装**：安装`mcp`（MCP核心库）和`arxiv`（论文检索SDK）：`uv add mcp arxiv`。


#### 4. 服务器测试工具：MCP Inspector
- **功能**：提供基于浏览器的可视化界面，用于测试MCP服务器的工具、资源和提示模板，无需编写客户端即可验证服务器功能。
- **启动方式**：通过命令`npx @model-context-protocol/inspector`启动，自动关联本地MCP服务器。
- **测试流程**：
  1. 选择传输方式为“stdio”（与服务器配置一致）。
  2. 输入服务器运行命令（如`uv run research_server.py`）。
  3. 连接服务器后，通过“Tools”选项卡查看所有暴露的工具。
  4. 测试工具调用：例如调用`search_papers`工具搜索“chemistry”主题，验证是否返回论文ID；使用返回的ID调用`extract_info`工具，检查是否能提取论文详情。


#### 5. 关键特性与优势
- **简化开发**：`fast MCP`通过装饰器自动处理工具schema生成，减少手动配置。
- **本地调试便捷**：标准IO传输适合本地开发，MCP Inspector提供直观的测试环境，快速验证工具功能。
- **可扩展性**：当前仅实现工具，后续可扩展添加资源和提示模板。


#### 6. 后续内容预告
下一课时将构建MCP客户端和主机，实现聊天机器人与MCP服务器的集成，通过MCP协议完成工具调用与交互。

